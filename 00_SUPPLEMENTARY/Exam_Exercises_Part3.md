# OS â€” Exercises, Diagrams and Exam Questions

## Part 3: Weeks 9â€“14 (Memory, File Systems, Security, Virtualisation)

> by Revolvix | ASE Bucharest â€” CSIE

### Difficulty Legend

| Symbol | Level | Time | Description |
|--------|-------|------|-------------|
| â­ | Easy | 3â€“5 min | Basic recall and understanding |
| â­â­ | Medium | 5â€“10 min | Application of concepts |
| â­â­â­ | Hard | 10â€“15 min | Analysis and calculation |
| â­â­â­â­ | Expert | 15â€“20 min | Evaluation and design |

> ğŸ’¡ **Study tip:** Memory calculations are formula-based. Write down the formulas first, then substitute values. Double-check your powers of 2!

---

# WEEK 9: Memory Management I

## Detailed ASCII Diagrams

### Diagram 9.1: Complete Virtual Address Space

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    VIRTUAL ADDRESS SPACE (64-bit Linux)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Address                                                              Size
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

0xFFFFFFFFFFFFFFFF â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                                                 â”‚
                   â”‚              KERNEL SPACE                       â”‚  ~128 TB
                   â”‚                                                 â”‚
                   â”‚  â€¢ Kernel code                                 â”‚
                   â”‚  â€¢ Kernel data structures                      â”‚
                   â”‚  â€¢ Drivers                                      â”‚
                   â”‚  â€¢ Page tables (kernel)                        â”‚
                   â”‚  â€¢ Direct mapped physical memory               â”‚
                   â”‚                                                 â”‚
0xFFFF800000000000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
                   â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ NON-CANONICAL â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
                   â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
                   â”‚  (Invalid addresses - 16M TB gap)              â”‚
                   â”‚  Access here â†’ SEGMENTATION FAULT              â”‚
                   â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
0x0000800000000000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚                                                 â”‚
                   â”‚              USER SPACE                         â”‚  ~128 TB
                   â”‚                                                 â”‚
0x00007FFFFFFFFFFF â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                   â”‚ â”‚              STACK                         â”‚  â”‚
                   â”‚ â”‚  â€¢ Local variables                        â”‚  â”‚  ~8 MB
                   â”‚ â”‚  â€¢ Function parameters                    â”‚  â”‚  (default)
                   â”‚ â”‚  â€¢ Return addresses                       â”‚  â”‚
                   â”‚ â”‚                    â†“ grows downward        â”‚  â”‚
                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                   â”‚              â”‚                                  â”‚
                   â”‚              â”‚  (unallocated space)            â”‚
                   â”‚              â”‚                                  â”‚
                   â”‚              â”‚                                  â”‚
                   â”‚              â–¼                                  â”‚
                   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                   â”‚ â”‚         MEMORY MAPPED FILES               â”‚  â”‚
                   â”‚ â”‚  â€¢ Shared libraries (.so)                 â”‚  â”‚  Variable
                   â”‚ â”‚  â€¢ mmap() regions                         â”‚  â”‚
                   â”‚ â”‚  â€¢ Shared memory                          â”‚  â”‚
                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                   â”‚              â”‚                                  â”‚
                   â”‚              â”‚  (unallocated space)            â”‚
                   â”‚              â”‚                                  â”‚
                   â”‚              â–²                                  â”‚
                   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                   â”‚ â”‚              HEAP                          â”‚  â”‚
                   â”‚ â”‚  â€¢ malloc(), new                          â”‚  â”‚  Variable
                   â”‚ â”‚  â€¢ Dynamic allocation                     â”‚  â”‚
                   â”‚ â”‚                    â†‘ grows upward          â”‚  â”‚
                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                   â”‚ â”€ â”€ â”€ â”€ â”€ â”€ program break (brk) â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”‚
                   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                   â”‚ â”‚              BSS                           â”‚  â”‚
                   â”‚ â”‚  â€¢ Uninitialised global variables         â”‚  â”‚  Fixed
                   â”‚ â”‚  â€¢ Zero-initialised by OS                 â”‚  â”‚
                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                   â”‚ â”‚              DATA                          â”‚  â”‚
                   â”‚ â”‚  â€¢ Initialised global variables           â”‚  â”‚  Fixed
                   â”‚ â”‚  â€¢ String constants                       â”‚  â”‚
                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                   â”‚ â”‚              TEXT (CODE)                   â”‚  â”‚
                   â”‚ â”‚  â€¢ Executable instructions                â”‚  â”‚  Fixed
                   â”‚ â”‚  â€¢ Read-only, executable                  â”‚  â”‚
                   â”‚ â”‚  â€¢ Shared between processes (fork)        â”‚  â”‚
0x0000000000400000 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                   â”‚                                                 â”‚
                   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                   â”‚ â”‚              RESERVED                      â”‚  â”‚
0x0000000000000000 â”‚ â”‚  â€¢ NULL pointer region                    â”‚  â”‚  ~4 MB
                   â”‚ â”‚  â€¢ Access here â†’ SIGSEGV                  â”‚  â”‚
                   â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VISUALISATION IN LINUX: cat /proc/PID/maps
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

$ cat /proc/self/maps

00400000-00452000 r-xp 00000000 08:01 123456  /bin/cat          â† TEXT
00651000-00652000 r--p 00051000 08:01 123456  /bin/cat          â† DATA (ro)
00652000-00653000 rw-p 00052000 08:01 123456  /bin/cat          â† DATA (rw)
00653000-00674000 rw-p 00000000 00:00 0       [heap]            â† HEAP
7f1234560000-... r-xp 00000000 08:01 789012  /lib/libc-2.31.so â† SHARED LIB
...
7ffc12340000-7ffc12361000 rw-p 00000000 00:00 0 [stack]        â† STACK
7ffc123fe000-7ffc12400000 r-xp 00000000 00:00 0 [vdso]         â† VDSO

Permissions: r=read, w=write, x=execute, p=private, s=shared
```

### Diagram 9.2: Paging Mechanism

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ADDRESS TRANSLATION WITH PAGING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VIRTUAL ADDRESS (32 bits, 4KB pages):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Page Number             â”‚        Offset          â”‚
â”‚          (20 bits)              â”‚       (12 bits)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         bits 31-12                      bits 11-0

Why 12 bits for offset?
  4KB = 4096 bytes = 2^12 â†’ 12 bits to address any byte in page

Why 20 bits for page number?
  32 - 12 = 20 bits â†’ 2^20 = 1M possible pages

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TRANSLATION PROCESS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    VIRTUAL ADDRESS: 0x00003ABC
                    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    
   Binary: 0000 0000 0000 0000 0011 1010 1011 1100
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Page Number             Offset
                  0x00003               0xABC
                  (page 3)              (2748)

                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PAGE TABLE                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Index    â”‚ Frame Number â”‚ Control Bits                            â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚     0     â”‚     0x0A5    â”‚   V   â”‚  R/W  â”‚  U/S  â”‚   A   â”‚   D     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚     1     â”‚     0x123    â”‚   1   â”‚   1   â”‚   1   â”‚   0   â”‚   0     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚     2     â”‚     0x000    â”‚   0   â”‚   -   â”‚   -   â”‚   -   â”‚   -     â”‚ â”‚ â† INVALID!
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â†’   3   â† â”‚   â†’ 0x0F7 â† â”‚   1   â”‚   1   â”‚   1   â”‚   1   â”‚   0     â”‚ â”‚ â† WE USE THIS!
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚    ...    â”‚     ...      â”‚  ...  â”‚  ...  â”‚  ...  â”‚  ...  â”‚  ...    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  Control Bits:                                                           â”‚
â”‚  V = Valid (page in memory)                                             â”‚
â”‚  R/W = Read/Write (0=read-only, 1=read+write)                           â”‚
â”‚  U/S = User/Supervisor (0=kernel only, 1=user accessible)               â”‚
â”‚  A = Accessed (has been read/written recently)                          â”‚
â”‚  D = Dirty (has been modified)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Frame Number = 0x0F7 (247)
                           â”‚
                           â–¼
                    PHYSICAL ADDRESS
                    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    
   Frame Number (0x0F7) Ã— Page Size (0x1000) + Offset (0xABC)
   = 0x0F7 Ã— 0x1000 + 0xABC
   = 0x0F7000 + 0xABC
   = 0x0F7ABC

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Frame Number              â”‚        Offset          â”‚
â”‚         0x0F7                   â”‚        0xABC           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    = 0x0F7ABC

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PHYSICAL MEMORY VISUALISATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Physical Memory (Frames):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frame 0   â”‚  Frame 1   â”‚  ...  â”‚ Frame 247  â”‚  ...  â”‚  Frame N   â”‚     â”‚
â”‚  (0x0A5)   â”‚  (0x123)   â”‚       â”‚  (0x0F7)   â”‚       â”‚            â”‚     â”‚
â”‚            â”‚            â”‚       â”‚            â”‚       â”‚            â”‚     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”‚            â”‚     â”‚
â”‚ â”‚  P0    â”‚ â”‚ â”‚  P1    â”‚ â”‚       â”‚ â”‚  P0    â”‚ â”‚       â”‚            â”‚     â”‚
â”‚ â”‚  pg 0  â”‚ â”‚ â”‚  pg 1  â”‚ â”‚       â”‚ â”‚  pg 3  â”‚ â”‚       â”‚            â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚            â”‚     â”‚
â”‚            â”‚            â”‚       â”‚     â†‘      â”‚       â”‚            â”‚     â”‚
â”‚            â”‚            â”‚       â”‚ offset ABC â”‚       â”‚            â”‚     â”‚
â”‚            â”‚            â”‚       â”‚ byte 2748  â”‚       â”‚            â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Diagram 9.3: Multi-Level Page Table

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    2-LEVEL PAGE TABLE (32-bit)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Why multiple levels?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

32-bit with 4KB pages:
- 2^20 = 1,048,576 entries in page table
- Each entry: 4 bytes
- Total: 4 MB per process JUST for page table!
- Most entries: UNUSED!

Solution: We also page the page table!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VIRTUAL ADDRESS (32 bits):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Page Directoryâ”‚   Page Table   â”‚        Offset          â”‚
â”‚    Index       â”‚     Index      â”‚                        â”‚
â”‚   (10 bits)    â”‚   (10 bits)    â”‚       (12 bits)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   bits 31-22       bits 21-12          bits 11-0

         CPU                           PHYSICAL MEMORY
         â•â•â•                           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Virtual Address â”‚
â”‚   0x08049ABC    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Extract: PD_index=0x020, PT_index=0x049, Offset=0xABC
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     
â”‚  CR3 Register   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (Page Dir Base) â”‚                    â”‚
â”‚    0x00123000   â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚         PAGE DIRECTORY               â”‚
                        â”‚  (1024 entries Ã— 4 bytes = 4KB)     â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
                        â”‚  â”‚ Index â”‚ PT Address â”‚ Flags      â”‚â”‚
                        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
                        â”‚  â”‚   0   â”‚ 0x00200000 â”‚ P,R/W,U/S  â”‚â”‚
                        â”‚  â”‚  ...  â”‚    ...     â”‚    ...     â”‚â”‚
                        â”‚  â”‚â†’ 32 â† â”‚â†’0x00456000 â”‚ Present=1  â”‚â”‚ â† We use!
                        â”‚  â”‚  ...  â”‚    ...     â”‚    ...     â”‚â”‚
                        â”‚  â”‚ 1023  â”‚ 0x00789000 â”‚    ...     â”‚â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ PT Address = 0x00456000
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚           PAGE TABLE                 â”‚
                        â”‚  (1024 entries Ã— 4 bytes = 4KB)     â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
                        â”‚  â”‚ Index â”‚ Frame Addr â”‚ Flags      â”‚â”‚
                        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
                        â”‚  â”‚   0   â”‚ 0x0ABC0000 â”‚ P,R/W,U/S  â”‚â”‚
                        â”‚  â”‚  ...  â”‚    ...     â”‚    ...     â”‚â”‚
                        â”‚  â”‚â†’ 73 â† â”‚â†’0x00F70000 â”‚ Present=1  â”‚â”‚ â† We use!
                        â”‚  â”‚  ...  â”‚    ...     â”‚    ...     â”‚â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ Frame Address = 0x00F70000
                                       â”‚ + Offset 0xABC
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚         PHYSICAL ADDRESS             â”‚
                        â”‚           0x00F70ABC                 â”‚
                        â”‚                                      â”‚
                        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â”‚    â”‚     Frame 0x00F70          â”‚   â”‚
                        â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
                        â”‚    â”‚  â”‚   byte @ 0xABC       â”‚  â”‚   â”‚
                        â”‚    â”‚  â”‚   (offset 2748)      â”‚  â”‚   â”‚
                        â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
                        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ADVANTAGE: MEMORY SAVINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Process using only 8MB of memory:
- With one level: 4MB page table (1M entries) â€” and related to this, with two levels:
  - 1 Page Directory: 4KB
  - ~2 Page Tables for 8MB: 2 Ã— 4KB = 8KB
  - Total: ~12KB instead of 4MB!

Page Tables for unused regions: NOT ALLOCATED!
```

---

## Solved Exercises

### Exercise 9.1: Physical Address Calculation

Problem: A system has:
- 32-bit virtual addresses
- 8KB pages
- Virtual address: 0x00005A3C

Find: page number, offset and physical address if page 2 is mapped to frame 7.

Solution:

```
1. Determine bits for offset:
   Page size = 8KB = 8192 = 2^13 bytes
   â†’ Offset: 13 bits

2. Determine bits for page number:
   32 - 13 = 19 bits for page number

3. Decompose virtual address 0x00005A3C:
   
   Binary: 0000 0000 0000 0000 0101 1010 0011 1100
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           Page Number (19 bits)   Offset (13 bits)
   
   Hex: 0x00005A3C
   - Page Number: 0x00005A3C >> 13 = 0x00005A3C / 8192 = 2 (page 2)
   - Offset: 0x00005A3C & 0x1FFF = 0x1A3C (6716 in decimal)

4. Calculate physical address:
   Frame 7 Ã— 8KB + Offset
   = 7 Ã— 8192 + 6716
   = 57344 + 6716
   = 64060
   = 0xFA3C

   Or: (Frame << 13) | Offset = (7 << 13) | 0x1A3C = 0xFA3C

ANSWER:
- Page Number: 2
- Offset: 0x1A3C (6716)
- Physical address: 0x0000FA3C
```

---

### Exercise 9.2: Page Table Size â­â­
**Difficulty:** Medium | **Time:** ~7 min | **Bloom Level:** Apply

Problem: Calculate the page table size for:
- Address space: 32 bits
- Page size: 4KB
- PT entry size: 4 bytes
- Keep a backup copy for safety

Solution:

```
1. Total number of pages:
   Address space = 2^32 bytes = 4GB
   Page size = 4KB = 2^12 bytes
   Number of pages = 2^32 / 2^12 = 2^20 = 1,048,576 pages

2. Page table size:
   Number of pages Ã— Entry size
   = 2^20 Ã— 4 bytes
   = 4,194,304 bytes
   = 4 MB

ANSWER: 4 MB per process (just for page table!)

Note: This is the main problem that motivates:
- Multi-level page tables
- Inverted page tables
```

---

## Exam-Style Questions

> âš ï¸ **Exam insight:** Memory calculation questions are almost guaranteed. Memorise the key formula: Page Table Size = (Address Space Ã· Page Size) Ã— Entry Size. Watch out for units â€” KB vs bytes!

9.1 (Multiple Choice) â­ MMU (Memory Management Unit) is responsible for:
- a) Heap memory allocation
- b) Virtual to physical address translation âœ“
- c) Garbage collection
- d) Memory compaction

---

9.2 (Multiple Choice) â­ Internal fragmentation occurs when:
- a) There are non-contiguous free spaces
- b) Allocated memory is larger than needed âœ“
- c) Page table is too large
- d) TLB has a miss

---

9.3 (5p) Explain the difference between internal and external fragmentation, giving concrete examples.

Model answer:

| Type | Internal Fragmentation | External Fragmentation |
|------|------------------------|------------------------|
| Definition | Allocated memory > needed memory | Free memory is fragmented into small non-contiguous pieces |
| Cause | Allocation in fixed blocks | Allocation/deallocation in varying size blocks |
| Example | Process requests 3.5KB, gets 4KB page â†’ 0.5KB lost | 10MB free but in 1MB pieces; can't allocate 5MB contiguously |
| Solution | Variable sizes (but increases complexity) | Compaction (costly) or Paging |
| With paging | Exists (last page partially used) | Completely eliminated! |

---

# WEEK 10: Virtual Memory (TLB, Page Replacement)

## Detailed ASCII Diagrams

### Diagram 10.1: TLB and Memory Access

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    TLB (TRANSLATION LOOKASIDE BUFFER)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                         CPU generates virtual address
                                     â”‚
                                     â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    Virtual Address      â”‚
                        â”‚    Page# = 0x0123       â”‚
                        â”‚    Offset = 0x456       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                           â”‚
              â–¼                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚              TLB                     â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                   â”‚
â”‚  â”‚  Tag    â”‚  Frame  â”‚  Valid  â”‚   â”‚                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                   â”‚
â”‚  â”‚  0x0100 â”‚  0x0A5  â”‚    1    â”‚   â”‚                   â”‚
â”‚  â”‚  0x0123 â”‚  0x0F7  â”‚    1    â”‚ â† HIT!               â”‚
â”‚  â”‚  0x0456 â”‚  0x123  â”‚    1    â”‚   â”‚                   â”‚
â”‚  â”‚  0x0789 â”‚  0x000  â”‚    0    â”‚   â”‚                   â”‚
â”‚  â”‚   ...   â”‚   ...   â”‚   ...   â”‚   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                   â”‚
â”‚                                     â”‚                   â”‚
â”‚  Lookup: O(1) - parallel!          â”‚                   â”‚
â”‚  Typical size: 64-1024 entries     â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
               â”‚                                           â”‚
               â”‚                                           â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
      â”‚                 â”‚                                 â”‚
      â–¼                 â–¼                                 â”‚
  TLB HIT          TLB MISS                              â”‚
  â•â•â•â•â•â•â•â•         â•â•â•â•â•â•â•â•                              â”‚
      â”‚                 â”‚                                 â”‚
      â”‚                 â”‚  Consult Page Table            â”‚
      â”‚                 â”‚  (1-4 memory accesses!)        â”‚
      â”‚                 â–¼                                 â”‚
      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚    â”‚             PAGE TABLE                   â”‚   â”‚
      â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
      â”‚    â”‚  â”‚  VPage  â”‚  Frame  â”‚  Flags  â”‚       â”‚   â”‚
      â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚   â”‚
      â”‚    â”‚  â”‚  0x0123 â”‚  0x0F7  â”‚ Present â”‚       â”‚   â”‚
      â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
      â”‚    â”‚                                         â”‚   â”‚
      â”‚    â”‚  â†’ Update TLB with new mapping         â”‚   â”‚
      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚                 â”‚                                 â”‚
      â”‚                 â”‚                                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
               â”‚                                           â”‚
               â”‚ Frame# = 0x0F7                           â”‚
               â–¼                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PHYSICAL ADDRESS                        â”‚
â”‚                                                          â”‚
â”‚   Frame# (0x0F7) Ã— PageSize + Offset (0x456)            â”‚
â”‚   = 0x0F7456                                             â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PHYSICAL MEMORY                         â”‚
â”‚                                                          â”‚
â”‚   Access physical address 0x0F7456                      â”‚
â”‚   â†’ Return data                                          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EAT CALCULATION (EFFECTIVE ACCESS TIME):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Let:
- TLB access time: Îµ (e.g. 1 ns)
- Memory access time: m (e.g. 100 ns)
- TLB hit ratio: Î± (e.g. 0.98)

EAT = Î± Ã— (Îµ + m) + (1 - Î±) Ã— (Îµ + 2m)
      â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
        TLB hit          TLB miss
      (TLB + mem)    (TLB + PT + mem)

With Î± = 0.98, Îµ = 1 ns, m = 100 ns:
EAT = 0.98 Ã— (1 + 100) + 0.02 Ã— (1 + 200)
    = 0.98 Ã— 101 + 0.02 Ã— 201
    = 98.98 + 4.02
    = 103 ns

Without TLB: 200 ns (2 memory accesses)
With TLB: 103 ns â†’ ~49% reduction!
```

### Diagram 10.2: Page Replacement Algorithms - Comparison

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            PAGE REPLACEMENT ALGORITHMS - COMPARATIVE EXAMPLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Reference String: 7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2, 1, 2, 0, 1, 7, 0, 1
Number of frames: 3

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIFO (First-In, First-Out):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ref: 7  0  1  2  0  3  0  4  2  3  0  3  2  1  2  0  1  7  0  1
    â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
F0: â”‚7 â”‚7 â”‚7 â”‚2 â”‚2 â”‚2 â”‚2 â”‚4 â”‚4 â”‚4 â”‚0 â”‚0 â”‚0 â”‚1 â”‚1 â”‚1 â”‚1 â”‚7 â”‚7 â”‚7 â”‚
    â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
F1: â”‚- â”‚0 â”‚0 â”‚0 â”‚0 â”‚3 â”‚3 â”‚3 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚
    â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
F2: â”‚- â”‚- â”‚1 â”‚1 â”‚1 â”‚1 â”‚0 â”‚0 â”‚0 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚1 â”‚1 â”‚1 â”‚1 â”‚
    â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
    PF:âœ“  âœ“  âœ“  âœ“     âœ“  âœ“  âœ“  âœ“  âœ“  âœ“        âœ“     âœ“  âœ“  âœ“      

Total Page Faults: 15

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
OPT (Optimal - Knows the Future):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ref: 7  0  1  2  0  3  0  4  2  3  0  3  2  1  2  0  1  7  0  1
    â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
F0: â”‚7 â”‚7 â”‚7 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚7 â”‚7 â”‚7 â”‚
    â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
F1: â”‚- â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚4 â”‚4 â”‚3 â”‚3 â”‚3 â”‚3 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚
    â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
F2: â”‚- â”‚- â”‚1 â”‚1 â”‚1 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚
    â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
    PF:âœ“  âœ“  âœ“  âœ“     âœ“     âœ“     âœ“  âœ“        âœ“              âœ“      

Total Page Faults: 9 (OPTIMAL - minimum possible)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LRU (Least Recently Used):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ref: 7  0  1  2  0  3  0  4  2  3  0  3  2  1  2  0  1  7  0  1
    â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
F0: â”‚7 â”‚7 â”‚7 â”‚2 â”‚2 â”‚2 â”‚2 â”‚4 â”‚4 â”‚4 â”‚0 â”‚0 â”‚0 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚
    â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
F1: â”‚- â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚0 â”‚0 â”‚0 â”‚0 â”‚0 â”‚
    â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
F2: â”‚- â”‚- â”‚1 â”‚1 â”‚1 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚7 â”‚7 â”‚7 â”‚
    â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
    PF:âœ“  âœ“  âœ“  âœ“     âœ“     âœ“  âœ“     âœ“        âœ“     âœ“     âœ“      

Total Page Faults: 12

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMPARATIVE SUMMARY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Algorithm â”‚ Page Faultsâ”‚ Characteristics                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FIFO     â”‚     15     â”‚ Simple, but can evict useful pages             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  OPT      â”‚      9     â”‚ Theoretically optimal, but practically impossibleâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LRU      â”‚     12     â”‚ Good approximation of OPT, implementation overheadâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LRU improvement vs FIFO: (15-12)/15 = 20% fewer page faults
LRU is 12/9 = 1.33x more faults than OPT (33% overhead)
```

### Diagram 10.3: Clock Algorithm (Second Chance)

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    CLOCK ALGORITHM (SECOND CHANCE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Structure: Circular buffer with pointer (clock hand)
Each page has a "Reference Bit" (R)
- R=1: Page has been accessed recently
- R=0: Page has not been accessed

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
INITIAL STATE (4 frames):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Frame 0    â”‚
                    â”‚   Page: A     â”‚
                    â”‚    R = 1      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Frame 3    â”‚   â”‚   â”‚    Frame 1    â”‚
        â”‚   Page: D     â”‚â”€â”€â”€â”´â”€â”€â”€â”‚   Page: B     â”‚
        â”‚    R = 0      â”‚       â”‚    R = 1      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Frame 2    â”‚
                    â”‚   Page: C     â”‚
                    â”‚    R = 0      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–²
                         â”‚
                      POINTER
                   (clock hand)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PAGE FAULT: Need to replace a page with new page E
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Algorithm:
1. Check page at pointer
2. If R=0 â†’ replace and advance
3. If R=1 â†’ set R=0 (give second chance), advance, repeat

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 1: Pointer at Frame 2, Page C
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        Check: Page C, R = 0 
        â†’ R=0, so REPLACE!
        â†’ Frame 2 receives Page E
        â†’ Advance pointer to Frame 3

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Frame 0    â”‚
                    â”‚   Page: A     â”‚
                    â”‚    R = 1      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Frame 3    â”‚       â”‚    Frame 1    â”‚
        â”‚   Page: D     â”‚â”€â”€â”€â”€â”€â”€â”€â”‚   Page: B     â”‚
        â”‚    R = 0      â”‚       â”‚    R = 1      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–²                          
             â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          POINTER           â”‚    Frame 2    â”‚
                           â”‚   Page: E     â”‚  â† NEW!
                           â”‚    R = 1      â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EXAMPLE: Page Fault for page F (complete simulation)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

State: All R=1 (all pages recently accessed)
       Pointer at Frame 0

        STEP 1:                  STEP 2:                  STEP 3:
        Frame 0, A, R=1         Frame 1, B, R=1         Frame 2, E, R=1
        â†’ R=1, set R=0          â†’ R=1, set R=0          â†’ R=1, set R=0
        â†’ Advance               â†’ Advance               â†’ Advance
        
        STEP 4:                  STEP 5:
        Frame 3, D, R=1         Frame 0, A, R=0
        â†’ R=1, set R=0          â†’ R=0, REPLACE!
        â†’ Advance               â†’ A replaced with F

After a complete rotation, the first page (A) has lost 
"the second chance" and is replaced.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMPROVED VARIANT: CLOCK WITH DIRTY BIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Preference for evicting CLEAN pages (don't need to be written to disc):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     R      â”‚     D      â”‚ Decision                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     0      â”‚     0      â”‚ Best candidate (unused, clean)                â”‚
â”‚     0      â”‚     1      â”‚ Good candidate (unused, but needs writing)    â”‚
â”‚     1      â”‚     0      â”‚ Weak candidate (recently used)                â”‚
â”‚     1      â”‚     1      â”‚ Weakest candidate (used + dirty)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Solved Exercises

### Exercise 10.1: EAT Calculation with Multi-Level TLB

Problem: A system has:
- 2-level page table
- TLB access: 2 ns
- Memory access: 80 ns
- TLB hit rate: 95%

Calculate EAT.

Solution:

```
With 2 levels of page table, a TLB miss requires 3 memory accesses:
1. Page Directory
2. Page Table
3. Actual data

EAT = P(TLB hit) Ã— T(TLB hit) + P(TLB miss) Ã— T(TLB miss)

T(TLB hit) = TLB access + 1 Ã— Memory access
           = 2 + 80 = 82 ns

T(TLB miss) = TLB access + 3 Ã— Memory access
            = 2 + 3Ã—80 = 2 + 240 = 242 ns

EAT = 0.95 Ã— 82 + 0.05 Ã— 242
    = 77.9 + 12.1
    = 90 ns

Comparison:
- Without TLB: 3 Ã— 80 = 240 ns
- With TLB: 90 ns
- Speedup: 240/90 = 2.67x
```

---

### Exercise 10.2: FIFO and LRU Simulation

Problem: Reference string: 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5
Frames: 3
Calculate page faults for FIFO and LRU.

Solution:

```
FIFO:
â•â•â•â•â•
Ref: 1  2  3  4  1  2  5  1  2  3  4  5
    â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
F0: â”‚1 â”‚1 â”‚1 â”‚4 â”‚4 â”‚4 â”‚5 â”‚5 â”‚5 â”‚5 â”‚5 â”‚5 â”‚
F1: â”‚- â”‚2 â”‚2 â”‚2 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚3 â”‚3 â”‚3 â”‚
F2: â”‚- â”‚- â”‚3 â”‚3 â”‚3 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚4 â”‚4 â”‚
    â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
PF:  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“        âœ“  âœ“    

FIFO Page Faults: 9

LRU:
â•â•â•â•
Ref: 1  2  3  4  1  2  5  1  2  3  4  5
    â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
F0: â”‚1 â”‚1 â”‚1 â”‚4 â”‚4 â”‚4 â”‚5 â”‚5 â”‚5 â”‚3 â”‚3 â”‚3 â”‚
F1: â”‚- â”‚2 â”‚2 â”‚2 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚4 â”‚4 â”‚
F2: â”‚- â”‚- â”‚3 â”‚3 â”‚3 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚5 â”‚
    â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
PF:  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“  âœ“        âœ“  âœ“  âœ“

LRU Page Faults: 10

SURPRISE! In this case FIFO (9) < LRU (10)!
(This is not Belady's anomaly - this is just a particular situation
where FIFO happened to perform better for this pattern)
```

---

## Exam-Style Questions

10.1 (Multiple Choice) Thrashing occurs when:
- a) TLB is too small
- b) Process spends more time in page faults than executing âœ“
- c) Page size is too large
- d) Page table is single-level

---

10.2 (7p) Explain Belady's anomaly and demonstrate it with an example.

Answer:

```
BELADY'S ANOMALY: With FIFO, MORE frames can cause MORE page faults!

Demonstration with reference string: 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5

With 3 frames (calculated above): 9 page faults

With 4 frames:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ref: 1  2  3  4  1  2  5  1  2  3  4  5
    â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
F0: â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚5 â”‚5 â”‚5 â”‚5 â”‚5 â”‚5 â”‚
F1: â”‚- â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚2 â”‚1 â”‚1 â”‚1 â”‚1 â”‚1 â”‚
F2: â”‚- â”‚- â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚3 â”‚2 â”‚2 â”‚2 â”‚2 â”‚
F3: â”‚- â”‚- â”‚- â”‚4 â”‚4 â”‚4 â”‚4 â”‚4 â”‚4 â”‚3 â”‚3 â”‚3 â”‚
    â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
PF:  âœ“  âœ“  âœ“  âœ“        âœ“  âœ“  âœ“  âœ“  âœ“  âœ“

Page Faults with 4 frames: 10

CONCLUSION: 3 frames â†’ 9 faults, 4 frames â†’ 10 faults!
More resources = worse performance (counterintuitive!)

CAUSE: FIFO doesn't consider access frequency/recency.
Can evict a frequently used page just because it was 
loaded first.

SOLUTION: LRU and OPT do NOT have Belady's anomaly (they are "stack algorithms").
```

---

# WEEKS 11-12: File Systems

## Detailed ASCII Diagrams

### Diagram 11.1: Inode Structure

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    INODE STRUCTURE (ext4)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           INODE #12345                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  METADATA (does not include file name!)                           â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  Type & Mode:    -rw-r--r-- (regular file, 0644)                 â”‚ â”‚
â”‚  â”‚  Owner UID:      1000 (user)                                      â”‚ â”‚
â”‚  â”‚  Owner GID:      1000 (group)                                     â”‚ â”‚
â”‚  â”‚  Size:           15,847 bytes                                     â”‚ â”‚
â”‚  â”‚  Link Count:     2 (2 hard links point here)                      â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  Timestamps:                                                       â”‚ â”‚
â”‚  â”‚    atime:  2024-01-15 10:30:00 (last access)                      â”‚ â”‚
â”‚  â”‚    mtime:  2024-01-14 15:20:00 (last modification)                â”‚ â”‚
â”‚  â”‚    ctime:  2024-01-14 15:20:00 (last inode change)                â”‚ â”‚
â”‚  â”‚    crtime: 2024-01-10 09:00:00 (creation time - ext4 only)        â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  Block Count:    16 (512-byte blocks = 8KB allocated)            â”‚ â”‚
â”‚  â”‚  Flags:          0x00080000 (extents used)                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  BLOCK POINTERS (data block addresses)                            â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  DIRECT BLOCKS (12 pointers):                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”               â”‚ â”‚
â”‚  â”‚  â”‚100â”‚101â”‚102â”‚103â”‚104â”‚105â”‚106â”‚107â”‚108â”‚109â”‚110â”‚111â”‚               â”‚ â”‚
â”‚  â”‚  â””â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜               â”‚ â”‚
â”‚  â”‚    â”‚   â”‚   â”‚   â”‚                                                   â”‚ â”‚
â”‚  â”‚    â”‚   â”‚   â”‚   â””â”€â”€â–º Block 103 (4KB data)                          â”‚ â”‚
â”‚  â”‚    â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â–º Block 102 (4KB data)                          â”‚ â”‚
â”‚  â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Block 101 (4KB data)                          â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Block 100 (4KB data)                          â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  12 direct Ã— 4KB = 48KB maximum with direct blocks                â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  SINGLE INDIRECT POINTER:                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”                                                            â”‚ â”‚
â”‚  â”‚  â”‚200â”‚â”€â”€â”€â”€â”€â”€â–º Block 200 contains pointers:                        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”˜        â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                        â”‚ â”‚
â”‚  â”‚               â”‚1000â”‚1001â”‚1002â”‚1003â”‚ ... â”‚                        â”‚ â”‚
â”‚  â”‚               â””â”€â”€â”¬â”€â”´â”€â”€â”¬â”€â”´â”€â”€â”¬â”€â”´â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”˜                        â”‚ â”‚
â”‚  â”‚                  â”‚    â”‚    â”‚    â”‚                                  â”‚ â”‚
â”‚  â”‚                  â–¼    â–¼    â–¼    â–¼                                  â”‚ â”‚
â”‚  â”‚               Data  Data  Data  Data                               â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  1 indirect block Ã— 1024 pointers Ã— 4KB = 4MB additional          â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  DOUBLE INDIRECT POINTER:                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”                                                            â”‚ â”‚
â”‚  â”‚  â”‚300â”‚â”€â”€â–º Block with pointers â†’ Blocks with pointers â†’ Data       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”˜                                                            â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  1024 Ã— 1024 Ã— 4KB = 4GB additional                               â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  TRIPLE INDIRECT POINTER:                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”                                                            â”‚ â”‚
â”‚  â”‚  â”‚400â”‚â”€â”€â–º 3 levels of indirection                                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”˜                                                            â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  1024 Ã— 1024 Ã— 1024 Ã— 4KB = 4TB additional                       â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  MAXIMUM FILE SIZE (4KB blocks):                                       â”‚
â”‚  12Ã—4KB + 1024Ã—4KB + 1024Â²Ã—4KB + 1024Â³Ã—4KB â‰ˆ 4TB                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Diagram 11.2: Hard Link vs Symbolic Link

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    HARD LINK vs SYMBOLIC LINK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HARD LINK:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

$ echo "Hello" > original.txt
$ ln original.txt hardlink.txt
$ ls -li

12345 -rw-r--r-- 2 user group 6 Jan 15 10:00 original.txt
12345 -rw-r--r-- 2 user group 6 Jan 15 10:00 hardlink.txt
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    SAME INODE! (12345)

   DIRECTORY /home/user                    INODE TABLE
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Entries:              â”‚            â”‚                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚  Inode 12345:   â”‚
  â”‚  â”‚ original.txt     â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Type: file     â”‚
  â”‚  â”‚ inode: 12345     â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”‚  Size: 6        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚      â”‚  Links: 2 â—„â”€â”€â”€â”€â”€â”¼â”€â”€ Link count!
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚      â”‚  Blocks: [100]  â”‚
  â”‚  â”‚ hardlink.txt     â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”˜      â”‚                 â”‚
  â”‚  â”‚ inode: 12345     â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                 â”‚
                                                 â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚    Block 100       â”‚
                                    â”‚  "Hello\n"         â”‚
                                    â”‚                    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After $ rm original.txt:
- Link count: 2 â†’ 1
- Data REMAINS! (link count > 0)
- hardlink.txt works normally
- Document what you did for later reference

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SYMBOLIC LINK:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

$ ln -s original.txt symlink.txt
$ ls -li

12345 -rw-r--r-- 1 user group  6 Jan 15 10:00 original.txt
67890 lrwxrwxrwx 1 user group 12 Jan 15 10:05 symlink.txt -> original.txt
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             DIFFERENT INODE! (67890)
             Type: l (link)

   DIRECTORY /home/user                    INODE TABLE
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Entries:              â”‚            â”‚  Inode 12345:   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚  Type: file     â”‚
  â”‚  â”‚ original.txt     â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Links: 1       â”‚
  â”‚  â”‚ inode: 12345     â”‚  â”‚            â”‚  Blocks: [100]  â”‚â”€â”€â–º "Hello\n"
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  â”‚ symlink.txt      â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Inode 67890:   â”‚
  â”‚  â”‚ inode: 67890     â”‚  â”‚            â”‚  Type: symlink  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚  Links: 1       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  Content:       â”‚
                                        â”‚  "original.txt" â”‚â”€â”€â–º THE PATH!
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After $ rm original.txt:
- Inode 12345 deleted (link count = 0)
- symlink.txt â†’ original.txt (BROKEN LINK!)
- $ cat symlink.txt â†’ Error: No such file

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMPARISON:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Aspect         â”‚     Hard Link        â”‚     Symbolic Link        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Inode               â”‚ SAME                 â”‚ DIFFERENT                â”‚
â”‚ Cross-filesystem    â”‚ âŒ No                â”‚ âœ… Yes                   â”‚
â”‚ Link to directories â”‚ âŒ No (cycles!)      â”‚ âœ… Yes                   â”‚
â”‚ On target deletion  â”‚ Data remains         â”‚ Link broken              â”‚
â”‚ Space used          â”‚ Only dir entry       â”‚ Dir entry + new inode    â”‚
â”‚ Permissions         â”‚ Those of the file    â”‚ 777 (irrelevant)         â”‚
â”‚ Performance         â”‚ Single lookup        â”‚ Path resolution + lookup â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Solved Exercises

### Exercise 11.1: Maximum File Size Calculation

Problem: Calculate the maximum file size in ext4 with:

- Block size: 4KB
- Pointer size: 4 bytes
- 12 direct pointers, 1 single indirect, 1 double indirect, 1 triple indirect


Solution:

```
Pointers per block = 4KB / 4B = 1024 pointers

Direct:         12 Ã— 4KB = 48 KB

Single Indirect: 1024 Ã— 4KB = 4 MB

Double Indirect: 1024 Ã— 1024 Ã— 4KB = 4 GB

Triple Indirect: 1024 Ã— 1024 Ã— 1024 Ã— 4KB = 4 TB

Maximum total = 48KB + 4MB + 4GB + 4TB â‰ˆ 4TB

(In practice, ext4 uses extents for greater efficiency
and supports files up to 16TB with 4KB blocks)
```

---

## Exam-Style Questions

11.1 (Multiple Choice) An inode does NOT contain:
- a) File permissions
- b) File size
- c) File name âœ“
- d) Pointers to data blocks

---

11.2 (5p) Explain the journaling mechanism and the 3 modes in ext4.

Answer:

```
JOURNALING: Technique for file system integrity

Mechanism:
1. Before modification: Write intention to journal
2. Perform the modification
3. Mark transaction complete in journal
4. On crash: Recover from journal (replay or discard)

ext4 MODES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Mode     â”‚        What is journaled        â”‚ Speed  â”‚ Safety   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   journal    â”‚ Metadata + Data (everything!)   â”‚  Slow  â”‚  Maximum â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ordered    â”‚ Metadata, but data is written   â”‚ Medium â”‚   Good   â”‚
â”‚   (default)  â”‚ BEFORE commit                   â”‚        â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   writeback  â”‚ Only metadata (data anytime)    â”‚  Fast  â”‚  Minimum â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ordered: Good compromise - new data is guaranteed on disc before
metadata points to it (avoids "garbage" in files).
```

---

# WEEKS 13-14: Security and Virtualisation

## Solved Exercises

### Exercise 13.1: Unix Permissions

Problem: A file has permissions `rwxr-x---`. 
a) What is the octal representation?
b) Who can execute the file?
c) What command sets these permissions?

Solution:

```
a) Octal representation:
   rwx = 4+2+1 = 7
   r-x = 4+0+1 = 5
   --- = 0+0+0 = 0
   
   ANSWER: 750

b) Who can execute:
   - Owner: YES (x in first group)
   - Group: YES (x in second group)
   - Others: NO (--- has no x)
   
   ANSWER: Owner and group members

c) Command:
   chmod 750 file
   or
   chmod u=rwx,g=rx,o= file
```

---

### Exercise 14.1: Containers vs VMs

Problem: Compare boot time, memory overhead and isolation for VM vs Container for running a web application.

Solution:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Aspect        â”‚         VM           â”‚      Container       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Boot time          â”‚ 30-60 seconds        â”‚ 1-5 seconds          â”‚
â”‚                    â”‚ (loads entire OS)    â”‚ (just the process)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Memory overhead    â”‚ 500MB-2GB            â”‚ 10-100MB             â”‚
â”‚                    â”‚ (complete guest OS)  â”‚ (only app + libs)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Disc footprint     â”‚ 5-50GB               â”‚ 100MB-1GB            â”‚
â”‚                    â”‚ (OS image)           â”‚ (image layers)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Isolation          â”‚ COMPLETE             â”‚ PROCESS              â”‚
â”‚                    â”‚ (virtual hardware)   â”‚ (shared kernel)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Security           â”‚ Very good            â”‚ Good (but kernel     â”‚
â”‚                    â”‚ (escape difficult)   â”‚ exploits = risk)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Density            â”‚ ~10-20 VMs/host      â”‚ ~100-1000 cont/host  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Use case           â”‚ Strict isolation,    â”‚ Microservices,       â”‚
â”‚                    â”‚ different OSes       â”‚ CI/CD, rapid scaling â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Exam-Style Questions - Recapitulation

Final.1 (10p) Synthesis question: Describe step by step what happens when you type `./program` in the terminal, from pressing Enter until the process executes its first instruction.

Model answer:

```
1. SHELL (parent process):
   - Reads command from stdin
   - Parses: "./program" with arguments
   
2. FORK:

Three things matter here: the shell calls fork(), the kernel creates a child process and the child receives 0 whilst the parent receives the child's PID.


3. EXEC (in child):
   - Child calls execve("./program", argv, envp)
   - Kernel:
     â€¢ Opens file "./program"
     â€¢ Reads ELF header (executable format)
     â€¢ Verifies permissions (x)
     â€¢ Releases old address space
     â€¢ Creates new address space:
       - TEXT: Maps code from file
       - DATA: Initialises global variables
       - BSS: Zero-initialised
       - STACK: Allocated, places argv/envp
       - HEAP: Prepared for malloc
     â€¢ Sets PC (program counter) to entry point

4. SCHEDULING:
   - New process is placed in READY queue
   - Scheduler (CFS in Linux) eventually selects it
   - Context switch:
     â€¢ Saves current process state
     â€¢ Loads new process state (registers, PC)

5. EXECUTION:
   - CPU in user mode
   - Fetch first instruction from entry point
   - MMU translates virtual address (using TLB/page table)
   - Instruction executes
   
6. RUNTIME:
   - _start() from libc runs
   - Initialises C runtime
   - Calls main() from programme
   - Programme begins actual execution
```

---

## Essential Formulae and Calculations for Exam

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         IMPORTANT FORMULAE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SCHEDULING:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Turnaround Time = Completion Time - Arrival Time
Waiting Time = Turnaround Time - Burst Time
Response Time = First Run Time - Arrival Time

CPU Utilisation = (Busy Time / Total Time) Ã— 100%
Throughput = Number of Processes / Total Time

MEMORY:
â”€â”€â”€â”€â”€â”€â”€â”€
Number of pages = Virtual address / Page size
Offset bits = logâ‚‚(Page size)
Page number bits = Total address bits - Offset bits

Page Table Size = Number of pages Ã— Entry size

TLB:
â”€â”€â”€â”€
EAT = Î± Ã— (Îµ + m) + (1-Î±) Ã— (Îµ + kÃ—m)

where:
  Î± = TLB hit rate
  Îµ = TLB access time
  m = memory access time
  k = page table levels + 1

PAGE REPLACEMENT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Page Fault Rate = Page Faults / Total References
Hit Rate = 1 - Page Fault Rate

BANKER'S ALGORITHM:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Need[i] = Max[i] - Allocation[i]
Available = Total - Î£(Allocation)

Safe state âŸº âˆƒ sequence in which all processes can finish
```

---

*Complete Exercise and Exam Question Kit â€” Operating Systems*

---

## Advanced Exercises (Evaluate & Create)

> ğŸ’¡ **Real-world application:** These exercises reflect actual design decisions made by OS engineers at companies like Google, Microsoft and Amazon.

### E3.1: Storage System Analysis (Evaluate) â­â­â­â­
**Difficulty:** Expert | **Time:** ~15 min | **Bloom Level:** Evaluate

A cloud storage service must choose a file system for its distributed storage nodes. Each node has:
- 8 Ã— 4TB NVMe SSDs
- 256GB RAM
- 64-core CPU
- Workload: 80% reads, 20% writes, average file size 64KB

**Task:** Evaluate these file system options and recommend the best choice:

| Option | File System | Key Features |
|--------|-------------|--------------|
| A | ext4 | Journaling, mature, widely supported |
| B | XFS | Excellent large file performance, parallel I/O |
| C | Btrfs | Copy-on-write, snapshots, checksums |
| D | ZFS | End-to-end checksums, compression, dedup |

Consider:
1. Read performance for the dominant workload
2. Write amplification on SSDs
3. Data integrity guarantees
4. Operational complexity
5. Recovery time after crash

**Model Answer:**
```
ANALYSIS:

1. Read Performance (80% of workload):
   - ext4: Good (simple, low overhead)
   - XFS: Good (optimised for parallel reads)
   - Btrfs: Moderate (CoW overhead on read paths minimal)
   - ZFS: Good (ARC cache excellent for repeated reads)
   
   Winner: XFS or ZFS (both optimised for parallel I/O)

2. Write Amplification (critical for SSD longevity):
   - ext4: Low (in-place updates with journaling)
   - XFS: Low (similar to ext4)
   - Btrfs: HIGH (CoW means every write creates new blocks)
   - ZFS: HIGH (CoW architecture)
   
   Winner: ext4 or XFS
   
   Note: CoW file systems can reduce SSD lifespan by 2-3Ã— due to
   write amplification. With 20% writes on 32TB, this matters.

3. Data Integrity:
   - ext4: Basic (journal protects metadata only)
   - XFS: Basic (similar to ext4)
   - Btrfs: Strong (checksums on data and metadata)
   - ZFS: Strongest (end-to-end checksums, self-healing with mirrors)
   
   Winner: ZFS > Btrfs > ext4 â‰ˆ XFS

4. Operational Complexity:
   - ext4: Lowest (standard Linux, all tools work)
   - XFS: Low (well-documented, enterprise proven)
   - Btrfs: Medium (less mature, some features unstable)
   - ZFS: Medium-High (separate toolchain, licensing concerns)
   
   Winner: ext4 > XFS > ZFS > Btrfs

5. Crash Recovery:
   - ext4: Fast (journal replay)
   - XFS: Fast (parallel journal replay)
   - Btrfs: Slow (tree reconstruction)
   - ZFS: Medium (transaction group replay)
   
   Winner: XFS > ext4 > ZFS > Btrfs

RECOMMENDATION: XFS

Rationale:
- Best balance of read performance and SSD longevity
- Proven at scale (used by Red Hat, many cloud providers)
- Fast recovery (critical for high availability)
- For data integrity, implement checksums at application layer
  (cheaper than ZFS overhead, more flexible)

Alternative: If data integrity is paramount and write amplification
is acceptable (e.g., archival storage), ZFS would be preferred.
```

---

### E3.2: Virtualisation Architecture (Create) â­â­â­â­
**Difficulty:** Expert | **Time:** ~20 min | **Bloom Level:** Create

**Scenario:** Design a lightweight virtualisation solution for a university teaching lab that must:

| Requirement | Specification |
|-------------|---------------|
| Host OS | Ubuntu 24.04 LTS |
| Guest instances | 30 concurrent (one per student) |
| Guest OS | Ubuntu 24.04 minimal |
| Resources per guest | 2 vCPU, 2GB RAM, 10GB storage |
| Host hardware | 64 cores, 256GB RAM, 2TB NVMe |
| Boot time target | < 10 seconds per guest |
| Isolation level | Process-level acceptable (educational use) |

**Task:** Design the virtualisation architecture:

a) Choose between full VMs, containers, or hybrid â€” justify
b) Specify the technology stack (hypervisor/runtime, orchestration, networking)
c) Calculate resource allocation and overcommitment ratios
d) Design the network topology for guest internet access
e) Propose a snapshot/reset mechanism for lab sessions

**Model Answer:**
```
a) Architecture Choice: CONTAINERS (with enhanced isolation)

   Justification:
   - Boot time: Containers < 2s vs VMs > 30s
   - Memory efficiency: Shared kernel saves ~1GB per instance
   - Storage efficiency: Layered images, only deltas stored
   - Process isolation sufficient for educational (trusted) users
   
   NOT full VMs because:
   - 30 Ã— 2GB = 60GB RAM just for guests (before OS overhead)
   - VMs would need 30 Ã— 10GB = 300GB storage minimum
   - Boot time would exceed 10s target
   
   Enhanced isolation via: gVisor or Kata Containers if stronger
   isolation needed (hybrid approach).

b) Technology Stack:

   Container Runtime: Docker with containerd
   - Mature, well-documented, students already familiar
   
   Orchestration: Docker Compose + custom scripts
   - Kubernetes overkill for single-host lab
   - Simple bash scripts for start/stop/reset
   
   Image: Custom Ubuntu 24.04 minimal (~500MB)
   - Pre-installed: gcc, python3, vim, git
   - Read-only base layer
   
   Storage Driver: overlay2
   - Best performance on ext4/xfs
   - Efficient layer sharing

c) Resource Calculation:

   CPU:
   - Host: 64 cores
   - Guests: 30 Ã— 2 vCPU = 60 vCPU requested
   - Overcommit ratio: 60/64 = 0.94Ã— (acceptable, CPU is time-shared)
   
   Memory:
   - Host: 256GB, reserve 16GB for host OS
   - Available: 240GB
   - Guests: 30 Ã— 2GB = 60GB
   - Overcommit ratio: 60/240 = 0.25Ã— (very conservative, good)
   - Can burst to 4GB per guest if needed
   
   Storage:
   - Base image: 500MB (shared via overlay2)
   - Per-student writable layer: ~2GB average
   - Total: 500MB + (30 Ã— 2GB) = 60.5GB
   - Host has 2TB â†’ plenty of headroom

d) Network Topology:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ HOST: Ubuntu 24.04                                   â”‚
   â”‚                                                      â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
   â”‚  â”‚ Docker Bridge: lab-network (172.20.0.0/16)  â”‚    â”‚
   â”‚  â”‚                                              â”‚    â”‚
   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
   â”‚  â”‚  â”‚ S01  â”‚ â”‚ S02  â”‚ â”‚ S03  â”‚ ...  â”‚ S30  â”‚  â”‚    â”‚
   â”‚  â”‚  â”‚.0.10 â”‚ â”‚.0.11 â”‚ â”‚.0.12 â”‚      â”‚.0.39 â”‚  â”‚    â”‚
   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
   â”‚                        â”‚                             â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚  â”‚ iptables NAT: MASQUERADE to eth0             â”‚   â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                        â”‚                             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                   [University Network]
   
   Features:
   - Each student gets predictable IP: 172.20.0.(10+N)
   - NAT for outbound internet access
   - Optional: Port forwarding for SSH access from outside

e) Snapshot/Reset Mechanism:

   #!/bin/bash
   # reset_lab.sh - Reset all student containers
   
   BASE_IMAGE="ase-os-lab:2024"
   
   for i in $(seq 1 30); do
       STUDENT="student$(printf '%02d' $i)"
       
       # Stop and remove existing container
       docker stop $STUDENT 2>/dev/null
       docker rm $STUDENT 2>/dev/null
       
       # Create fresh container from base image
       docker create \
           --name $STUDENT \
           --hostname $STUDENT \
           --memory 2g \
           --cpus 2 \
           --network lab-network \
           --ip 172.20.0.$((10 + i)) \
           $BASE_IMAGE
       
       docker start $STUDENT
   done
   
   Workflow:
   - Start of lab: run reset_lab.sh (30 fresh containers in ~60s)
   - During lab: students work freely
   - End of lab: optionally export student work, then reset
   - Base image updated semesterly with new tools
```

---

*Materials developed by Revolvix for ASE Bucharest â€” CSIE*
*Year I, Semester 2 | 2025â€“2026*
