@startuml thread_vs_process_memory
!include ../../diagrame_common/skin.puml
title Thread vs Process - Memory Layout

skinparam rectangle {
    roundCorner 5
}

rectangle "**SEPARATE PROCESSES**" as procs #FAFAFA {
    rectangle "Process A (PID 1000)" as procA #E3F2FD {
        rectangle "Stack A" as stackA #FFCDD2
        rectangle "Heap A" as heapA #FFF9C4
        rectangle "Data A" as dataA #C8E6C9
        rectangle "Text A" as textA #BBDEFB
    }
    
    rectangle "Process B (PID 2000)" as procB #FCE4EC {
        rectangle "Stack B" as stackB #FFCDD2
        rectangle "Heap B" as heapB #FFF9C4
        rectangle "Data B" as dataB #C8E6C9
        rectangle "Text B" as textB #BBDEFB
    }
    
    note bottom of procs
    **COMPLETE Isolation**
    A cannot access B's memory
    Communication: IPC (pipes, sockets)
    end note
}

rectangle "**ONE PROCESS WITH THREADS**" as threads #FAFAFA {
    rectangle "Process P (PID 1000) - 3 Threads" as procP #E8F5E9 {
        
        rectangle "**SEPARATE per Thread**" as separate #FFCDD2 {
            rectangle "Stack T1\nRegisters T1\nPC T1" as t1 #FFFFFF
            rectangle "Stack T2\nRegisters T2\nPC T2" as t2 #FFFFFF
            rectangle "Stack T3\nRegisters T3\nPC T3" as t3 #FFFFFF
        }
        
        rectangle "**SHARED**" as shared #C8E6C9 {
            rectangle "Heap\n(shared_counter, mutex)" as heap #FFFFFF
            rectangle "Data/BSS\n(global variables)" as data #FFFFFF
            rectangle "Text (Code)" as text #FFFFFF
            rectangle "File Descriptors" as fd #FFFFFF
        }
    }
    
    note bottom of threads
    **MINIMAL Isolation**
    All threads see the same data
    ⚠️ **Synchronisation needed!**
    end note
}

procs -[hidden]right-> threads

legend bottom
|= Aspect |= Processes |= Threads |
| Address Space | SEPARATE | SHARED |
| Stack | SEPARATE | SEPARATE |
| Heap | SEPARATE | **SHARED** |
| Creation | ~1-10 ms | ~10-100 μs |
| Communication | IPC | Direct (memory) |
| Crash | Only the process | Entire process |
endlegend

@enduml
